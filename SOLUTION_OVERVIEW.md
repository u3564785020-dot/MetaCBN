# üìã –û–±–∑–æ—Ä —Ä–µ—à–µ–Ω–∏—è: Railway + Telegram –¥–ª—è —á–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. Backend API –Ω–∞ Railway
- **Node.js + Express** —Å–µ—Ä–≤–µ—Ä
- **PostgreSQL** –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- REST API endpoints –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot API

### 2. Telegram Bot –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —á–∞—Ç–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏

### 3. Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è URL API
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º —á–∞—Ç–∞

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
CobanMetaPhish/
‚îú‚îÄ‚îÄ railway-backend/              # Backend –¥–ª—è Railway
‚îÇ   ‚îú‚îÄ‚îÄ server.js                 # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä (API + Telegram Bot)
‚îÇ   ‚îú‚îÄ‚îÄ package.json              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Node.js
‚îÇ   ‚îú‚îÄ‚îÄ railway.json              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Railway
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile                # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ nixpacks.toml            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nixpacks
‚îÇ   ‚îú‚îÄ‚îÄ config.js                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore                # Git ignore
‚îÇ   ‚îî‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è backend
‚îÇ
‚îú‚îÄ‚îÄ update-frontend-api.js        # –°–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è URL –≤ frontend
‚îú‚îÄ‚îÄ SETUP_RAILWAY.md              # –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
‚îú‚îÄ‚îÄ QUICK_START.md                # –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
‚îî‚îÄ‚îÄ SOLUTION_OVERVIEW.md         # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞:

1. **–ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–∞—Ç–∞
2. **Frontend** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `/api/support/sendMessage`
3. **Railway Backend** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ PostgreSQL
4. **Telegram Bot** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É:
   - –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ —á–∞—Ç—É ‚Üí —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Å—Ä–∞–∑—É
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞:

1. **–û–ø–µ—Ä–∞—Ç–æ—Ä** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –±–æ—Ç–∞
2. **Telegram Bot** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ webhook/polling
3. **Backend** —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ PostgreSQL (message_from = 0)
4. **–ö–ª–∏–µ–Ω—Ç** –ø–æ–ª—É—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ polling –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã

## üéØ API Endpoints

### `POST /api/support/sendMessage`
–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

**Request:**
```json
{
  "supportToken": "ayb0uj0hyu9mhul0ftp",
  "message": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
}
```

**Response:**
```json
{
  "success": true,
  "message": {
    "id": 1,
    "support_token": "ayb0uj0hyu9mhul0ftp",
    "message": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
    "message_from": 1,
    "created_at": "2024-01-01T12:00:00Z"
  }
}
```

### `POST /api/support/sendImage`
–û—Ç–ø—Ä–∞–≤–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

**Request:** `multipart/form-data`
- `supportToken`: string
- `image`: File

**Response:** –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ sendMessage

### `POST /api/support/getMessages1`
–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–∞—Ç–∞ (polling)

**Request:**
```json
{
  "supportToken": "ayb0uj0hyu9mhul0ftp"
}
```

**Response:**
```json
{
  "messages": [
    {
      "id": 1,
      "message": "–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
      "messageFrom": 1,
      "image": false,
      "createdAt": "2024-01-01T12:00:00Z"
    }
  ]
}
```

### `GET /health`
Health check –¥–ª—è Railway

**Response:**
```json
{
  "status": "ok"
}
```

## ü§ñ Telegram Bot –∫–æ–º–∞–Ω–¥—ã

- `/start` - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
- `/chat <support_token>` - –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —á–∞—Ç—É –∫–ª–∏–µ–Ω—Ç–∞
- `/disconnect` - –û—Ç–∫–ª—é—á–∏—Ç—å—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —á–∞—Ç–∞
- `/list` - –ü–æ–∫–∞–∑–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —á–∞—Ç—ã
- `/help` - –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `messages`

```sql
CREATE TABLE messages (
  id SERIAL PRIMARY KEY,
  support_token VARCHAR(255) NOT NULL,
  message TEXT NOT NULL,
  message_from INTEGER NOT NULL DEFAULT 1,
  image_url TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

**–ü–æ–ª—è:**
- `id` - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–æ–±—â–µ–Ω–∏—è
- `support_token` - –¢–æ–∫–µ–Ω —Å–µ—Å—Å–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
- `message` - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `message_from` - –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å (0 = –æ–ø–µ—Ä–∞—Ç–æ—Ä, 1 = –∫–ª–∏–µ–Ω—Ç)
- `image_url` - URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
- `created_at` - –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è

**–ò–Ω–¥–µ–∫—Å—ã:**
- `idx_support_token` - –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–æ–∫–µ–Ω—É
- `idx_created_at` - –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:
- `DATABASE_URL` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è Railway
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather
- `PORT` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è Railway

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:
- `ADMIN_CHAT_IDS` - —Å–ø–∏—Å–æ–∫ chat_id –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (–¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π)
- `NODE_ENV` - –æ–∫—Ä—É–∂–µ–Ω–∏–µ (production/development)

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

1. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** - PostgreSQL –Ω–∞ Railway —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –±—ç–∫–∞–ø–∞–º–∏
3. **–£–¥–æ–±—Å—Ç–≤–æ** - –û–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ Telegram, –Ω–µ –Ω—É–∂–µ–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
4. **–≠–∫–æ–Ω–æ–º–∏—á–Ω–æ—Å—Ç—å** - $5 –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∫–∞–∂–¥—ã–π –º–µ—Å—è—Ü –Ω–∞ Railway
5. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞, –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ backend –Ω–∞ Railway (—Å–º. `QUICK_START.md`)
2. –°–æ–∑–¥–∞–π—Ç–µ Telegram –±–æ—Ç–∞ (—Å–º. `SETUP_RAILWAY.md`)
3. –û–±–Ω–æ–≤–∏—Ç–µ frontend URL (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `update-frontend-api.js`)
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç—É —á–∞—Ç–∞
5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–æ–æ–±—â–µ–Ω–∏—è —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL –Ω–∞ Railway
- –û–ø–µ—Ä–∞—Ç–æ—Ä –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏ –¥–æ—Å—Ç—É–ø–Ω–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–µ —Å—Ç–æ—Ä–æ–Ω—ã
- Polling –∏–Ω—Ç–µ—Ä–≤–∞–ª: 1.5 —Å–µ–∫—É–Ω–¥—ã (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ frontend)

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Railway Dashboard
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check: `https://your-app.up.railway.app/health`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Telegram –±–æ—Ç –∑–∞–ø—É—â–µ–Ω (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏)

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ

